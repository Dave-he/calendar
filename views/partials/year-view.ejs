<div class="year-grid">
    <% for (let m = 1; m <= 12; m++) { %>
        <div class="month-mini">
            <h3><%= m %>月</h3>
            <div class="mini-calendar">
                <div class="weekdays">
                    <div>日</div><div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div>
                </div>
                <div class="days">
                    <%
                        const firstDay = moment(`${year}-${m.toString().padStart(2, '0')}-01`);
                        const startOfWeek = firstDay.clone().startOf('week');
                        const endOfMonth = firstDay.clone().endOf('month');
                        const endOfWeek = endOfMonth.clone().endOf('week');
                        
                        for (let day = startOfWeek.clone(); day.isSameOrBefore(endOfWeek); day.add(1, 'day')) {
                            const isCurrentMonth = day.month() + 1 === m;
                            const isToday = day.format('YYYY-MM-DD') === today;
                            const dateKey = day.format('YYYY-MM-DD');
                            const dayEvents = events[dateKey] || [];
                            const eventCount = dayEvents.length;
                    %>
                        <div class="day mini-day <%= isCurrentMonth ? 'current-month' : 'other-month' %> <%= isToday ? 'today' : '' %>"
                             data-bg-color="<%= isCurrentMonth ? getDateColor(day.toDate()) : '#f5f5f5' %>"
                             onclick="openEventModal('<%= dateKey %>')">
                            <span class="day-number"><%= day.date() %></span>
                            <% if (eventCount > 0) { %>
                                <span class="event-indicator">•</span>
                            <% } %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    <% } %>
</div>